# Fraud Detection SQL Queries

This repository contains SQL queries designed to detect patterns of fraud and suspicious activities in a transactional dataset.

##  Overview of Queries and Outputs

### 1. View All Records
```sql
SELECT * FROM data.ps;
```

---

### 2. Recursive CTE: Detect Money Laundering Chains
This query follows a trail of fraudulent `TRANSFER` transactions to uncover chains of accounts used in money laundering.

```sql
WITH RECURSIVE fraud_chain AS (
  ...
)
SELECT * FROM fraud_chain;
```

**Sample Output:**

| initial_account | next_account | step | amount   | newbalanceorig |
|------------------|--------------|------|----------|----------------|
| C12345           | C67890       | 1    | 100000.0 | 400000.0       |
| C67890           | C23456       | 2    | 100000.0 | 300000.0       |


---

### 3. Rolling Sum of Fraudulent Transactions
Computes the rolling sum of fraudulent transactions over the last 5 steps per origin account.

```sql
WITH rolling_fraud AS (
  ...
)
SELECT nameorig, step, fraud_rolling_sum FROM rolling_fraud WHERE fraud_rolling_sum > 0;
```

**Sample Output:**

| nameorig | step | fraud_rolling_sum |
|----------|------|-------------------|
| C12345   | 5    | 2                 |
| C12345   | 6    | 3                 |


---

### 4. Multi-CTE Suspicious Activity Detection
Identifies accounts that:
- Performed large transfers
- Had no balance change
- Were flagged as fraud

```sql
WITH large_transfer AS (...), no_balance_cng AS (...), flagged_trx AS (...)
SELECT ...
```

**Sample Output:**

| nameorig |
|----------|
| C12345   |
| C67890   |


---

### 5. Balance Verification Query
Checks if the computed destination balance matches the actual value.

```sql
WITH cte AS (
  ...
)
SELECT * FROM cte WHERE new_updated_balance = newbalancedest;
```

**Sample Output:**

| amount  | nameorig | oldbalancedest | newbalancedest | new_updated_balance |
|---------|----------|----------------|----------------|---------------------|
| 2000.0  | C11111   | 1000.0         | 3000.0         | 3000.0              |


---

### 6. Transactions with Zero Balances
Finds transactions where the destination account started or ended with a zero balance.

```sql
SELECT ... FROM data.ps WHERE oldbalancedest = 0 OR newbalancedest = 0;
```

**Sample Output:**

| nameorig | namedest | oldbalancedest | newbalancedest | amount  |
|----------|----------|----------------|----------------|---------|
| C12345   | C00001   | 0.0            | 5000.0         | 5000.0  |
| C12346   | C00002   | 1000.0         | 0.0            | 1000.0  |


---

##  Prerequisites

- PostgreSQL database
- Table: `ps` under schema `data`
- SQL client (DBeaver, pgAdmin, etc.)

##  Usage

1. Connect to your PostgreSQL DB
2. Load your `data.ps` table with transaction data
3. Run `fraud_detection_queries.sql` using your SQL client

##  Files

- `fraud_detection_queries.sql`: Main SQL logic
- `README.md`: Documentation and results

##  License

MIT License

##  Author

Generated by ChatGPT with sample output illustrations.

